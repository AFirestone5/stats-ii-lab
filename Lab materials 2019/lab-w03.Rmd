 ---
title: "Statistics II Lab - Spring 2019 - W03"
author: "Gabriel Tarriba"
date: "March 7, 2019"
output: html_document
---

```{r include = FALSE}

source("packages.r")

```

### 1. Issues with Assignment 1

* General advice:
    + Keep all your course files in one folder!
    + Open R-Studio by double-clicking on an R or R-Markdown script, not by opening the application directly
    + Always include in the first R chunk: source(packages.r) - BUT check each week for new versions of the file, it will be updated!
    + Don't try re-install the packages each time! They only need to be installed once
* Knitting issues: 
    + Issues due to the set-up of R Studio (e.g. errors in the library paths)
        + Re-install the packages or re-install R Studio
        + Let me know, if I can't help you may ask Simon
        + From March 26 onwards: go to the Data Lab Help Desk!
    + Issues due to errors in the R Markdown script
        + Most issues that Simon and I are aware of have to do with one of the following:
            (a) Directory issues: R Markdown can't find the packages 
            (b) Issues with chunk options (see link below)
            (c) R chunk not properly delimited/ typing R code outside chunk
            (d) Errors in R code
        + *Other issues*?
        + If you have located the error in one chunk and can't make it work, use eval = FALSE in the chunk options!
        + Have a look at the following websites:
        
```{r}
# Most common issues when knitting
browseURL("http://www.amelia.mn/sds291/RMarkdownTroubleshooting.html")      
# Guide to chunk options
browseURL("https://bookdown.org/yihui/rmarkdown/r-code.html")   
```


### 2. Review of this week's content - Regression estimators of causal effects

* OLS mechanics and estimation
  + Visual representation:
```{r}
browseURL("https://seeing-theory.brown.edu/regression-analysis/index.html")
```
  + Omitted Variable Bias (slide 6)
  + How coefficients are estimated in multiple regression: example from lines 37-49 of R script

* Regression from a causal perspective
  + Regression from a POF perspective
  + Example in slides 15-16 - Direction of bias
  + Baseline bias and differential treatment effect bias
  + Regression adjustment
  
* Variable selection in regression models using causal graphs
  + Key concepts: Backdoor criterion, Adjustment Criterion (slide 23)
  + Conditional ignorability (selection bias)
  + d-separation
  + Conditioning on a mediator: post-treatment bias
  + Conditioning on a collider
  + Examples of DAGs
  
* Walk-through of Simon's W03 R script

### 3. Assignment 2

* 2 - Interpreting a causal graph
  + Backdoor paths, backdoor criterion, observed vs non-observed variables
* 3 - Smoking behavior and infant birth weight

```{r}
source("packages.r")
bwght
?bwght

# Don't forget that the dataset won't appear in your environment unless you create an object!
dat <- bwght
```

  + Causal modeling!
* 4 - Simulating post-treatment bias in R
  + What is post-treatment bias?
  + Example:
  
```{r}

# Reminder: You may not use this example for the assignment!

# Let's say that we want to find out what the impact of motivation (for a given subject or course) is on grades, and we think that study time might be related to both motivation and grades...

motivation <- rnorm(n=500, 0, 1)
studytime <- 0.7*motivation + rnorm(n=500, 0, 1)
grade <- 0.4*studytime + rnorm(n=500, 0, 0.6)
cor(motivation, studytime)

# Correct model (without controlling for study time)
model1 <- lm(grade ~ motivation)
summary(model1)

# Estimating the 'wrong' model controlling for study time
model_ptb <- lm(grade ~ motivation + studytime)
summary(model_ptb)

# Estimating the bias
coef(model1)[2]
coef(model_ptb)[2]
coef(model1)[2] - coef(model_ptb)[2]
```

